function ImageService(){this.url="https://api.giphy.com/v1/gifs/search"}function ImageModal(a){this.parentElement=a,this.element=this.createModalElement(),this.parentElement.appendChild(this.element),this.elementClass="image-gallery__modal-wrapper"}function ImageGallery(a){if(this.selectorId=a,this.element=document.getElementById(this.selectorId),!this.element)throw"Unable to find element with ID "+this.selectorId;this.imagesWrapper=this.createImagesWrapperElement(),this.element.appendChild(this.imagesWrapper),this.addMore=this.createAddMoreLinkElement(),this.element.appendChild(this.addMore),this.modal=new ImageModal(this.element),this.imageService=new ImageService,this.pagination={},this.images=[],this.addImages()}function PatApp(a){this.imageGallery=new ImageGallery(a)}var patAppConfig={giphyKey:"dc6zaTOxFJmzC"};ImageService.prototype.getImages=function(a,b){var c=this,d=new Promise(function(d,e){patAppConfig.giphyKey||e("Giphy api key not configured, please update config.js with it.");var f=new XMLHttpRequest;f.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var a=JSON.parse(this.responseText);a?d(a):e("Unable to parse data.")}else 4===this.readyState&&e("Call returned with code "+this.status)};var g=c.url+"?api_key="+patAppConfig.giphyKey+"&q="+a;b.offset&&(g+="&offset="+b.offset),f.open("GET",g,!0),f.send()});return d},ImageModal.prototype.displayImage=function(a){function b(b){var d=c.element.getElementsByClassName("image-gallery__modal-control--"+b)[0];if(!d)throw"Unable to find "+b+" link";a[b]?(d.style.display="inline",d.onclick=function(d){return d.preventDefault(),c.displayImage(a[b]),!1}):d.style.display="none"}var c=this,d=this.element.getElementsByClassName("image-gallery__modal-image-caption-wrapper")[0],e=d.getElementsByClassName("image-gallery__modal-image-caption")[0];e.innerHTML=a.slug||"No Caption";var f=this.element.getElementsByClassName("image-gallery__modal-image-wrapper")[0],g=document.createElement("img"),h=a.images.original;g.src=h.url,g.width=h.width,g.height=h.height,g.className="image-gallery__modal-image",this.img?f.replaceChild(g,this.img):f.insertBefore(g,d),this.img=g,this.element.style.display="block",b("next"),b("prev")},ImageModal.prototype.closeModal=function(){this.element.style.display="none"},ImageModal.prototype.createModalElement=function(){var a=this,b=document.createElement("div");b.style.display="none",b.className="image-gallery__modal-wrapper",b.innerHTML='<div class="image-gallery__modal-controls"><a href="#" class="image-gallery__modal-control image-gallery__modal-control--prev" title="Previous Image">&#60;&#60; </a> <a href="#" class="image-gallery__modal-control image-gallery__modal-control--next" title="Next Image">&#62;&#62; </a> <a href="#" class="image-gallery__modal-control image-gallery__modal-control--close" title="Close Image"> Ã— </a></div><div class="image-gallery__modal-content"><div class="image-gallery__modal-image-wrapper"><div class="image-gallery__modal-image-caption-wrapper"><p class="image-gallery__modal-image-caption"></p></div></div></div>';var c=b.getElementsByClassName("image-gallery__modal-control--close")[0];return c.onclick=function(b){return b.preventDefault(),a.closeModal(),!1},document.onkeydown=function(a){switch(a.which||a.keyCode){case 37:b.getElementsByClassName("image-gallery__modal-control--prev")[0].click();break;case 39:b.getElementsByClassName("image-gallery__modal-control--next")[0].click()}},b},ImageGallery.prototype.addImages=function(a){var b=this;b.imageService.getImages("cats",{offset:a}).then(function(a){b.pagination=a.pagination;var c=a.data;b.images.length&&c.length&&(b.images[b.images.length-1].next=c[0]);for(var d=0;d<c.length;d++)c[d].prev=b.images[b.images.length-1]||null,c[d].next=c[d+1]||null,b.imagesWrapper.appendChild(b.createImageElement(c[d])),b.images.push(c[d]);b.pagination.total_count<=b.pagination.offset+b.pagination.count&&(b.addMore.style.display="none")})},ImageGallery.prototype.createImageElement=function(a){var b=this,c=document.createElement("div");c.className="image-gallery__image-wrapper";var d=a.images.fixed_height_downsampled,e=document.createElement("a");c.appendChild(e),e.className="image-gallery__image-link",e.href=a.bitly_url,e.onclick=function(c){return c.preventDefault(),b.modal.displayImage(a),!1};var f=document.createElement("img");return e.appendChild(f),f.width=d.width,f.height=d.height,f.src=d.url,f.className="image-gallery__image",c},ImageGallery.prototype.createImagesWrapperElement=function(){var a=document.createElement("div");return a.className="image-gallery__images-wrapper",a},ImageGallery.prototype.createAddMoreLinkElement=function(){var a=this,b=document.createElement("div");b.className="image-gallery__add-more-wrapper";var c=document.createElement("a");return c.className="image-gallery__add-more",c.href="#",c.innerHTML="More",c.onclick=function(b){return b.preventDefault(),a.addImages(a.pagination.offset+a.pagination.count||0),!1},b.appendChild(c),b},document.addEventListener("DOMContentLoaded",function(){try{new PatApp("pat-image-gallery")}catch(a){window.alert(a.message)}});